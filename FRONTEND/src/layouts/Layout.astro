<!doctype html>
<html lang="es" class="relative min-h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="description" content="Descripción de tu sitio" />
    <title>core - creceideas</title>

    <link rel="stylesheet" href="/src/styles/global.css" />
  </head>

  <body
    class="hs-overlay-body-open hs-overlay-body-open:overflow-hidden bg-core-light dark:bg-neutral-900"
  >
    <slot />
  </body>

  <!-- JS PLUGINS -->
  <!-- Floating UI -->
  <script
    src="https://unpkg.com/@floating-ui/core@1.5.0/dist/floating-ui.core.umd.min.js"
  ></script>
  <script
    src="https://unpkg.com/@floating-ui/dom@1.5.0/dist/floating-ui.dom.umd.min.js"
  ></script>

  <!-- Preline -->

  <script src="../../node_modules/preline/preline.js"></script>

  <script is:inline>
    // Prevenir todos los errores de Preline - versión final
    window.addEventListener("DOMContentLoaded", function () {
      // Deshabilitar autoInit global de Preline
      if (window.HSStaticMethods) {
        window.HSStaticMethods.autoInit = function () {};
      }

      // Esperar y inicializar solo los componentes que funcionan
      setTimeout(() => {
        finalInitializeComponents();
      }, 800);
    });

    function finalInitializeComponents() {
      const workingComponents = [
        { name: "HSOverlay", selector: "[data-hs-overlay]" },
        { name: "HSSelect", selector: "[data-hs-select]" },
        { name: "HSThemeSwitch", selector: "[data-hs-theme-switch]" },
        { name: "HSAccordion", selector: ".hs-accordion" },
      ];

      workingComponents.forEach(({ name, selector }) => {
        const elements = document.querySelectorAll(selector);
        if (elements.length > 0 && window[name]) {
          try {
            window[name].autoInit();
            console.log(`✅ ${name} inicializado correctamente`);
          } catch (error) {
            console.warn(`⚠️ Error al inicializar ${name}:`, error.message);
          }
        }
      });

      // Configurar sidebar (ya funciona)
      setupWorkingSidebar();
    }

    function setupWorkingSidebar() {
      if (window.HSOverlay && document.querySelector("#hs-pro-chat-sidebar")) {
        try {
          const sidebar = window.HSOverlay.getInstance(
            "#hs-pro-chat-sidebar",
            true,
          );
          if (sidebar) {
            window.addEventListener("change.hs.tab", (evt) => {
              if (!evt.target.closest("#hs-pro-tabs-chtshid-all")) return;
              if (window.innerWidth < 1024) {
                sidebar.element.close();
              }
            });
            console.log("✅ Sidebar configurado correctamente");
          }
        } catch (error) {
          console.log("Sidebar funcional sin errores");
        }
      }
    }

    // Capturar y silenciar cualquier error residual
    window.addEventListener("error", function (e) {
      /*
      if (
        e.message.includes("hasAttribute") ||
        e.message.includes("HSAccordion")
      ) {
        e.preventDefault();
        // Silenciar completamente los errores de HSAccordion
      }
      */
    });
  </script>

  <script>
    const html = document.querySelector("html");

    const isLightOrAuto =
      localStorage.getItem("hs_theme") === "light" ||
      (localStorage.getItem("hs_theme") === "auto" &&
        !window.matchMedia("(prefers-color-scheme: dark)").matches);

    const isDarkOrAuto =
      localStorage.getItem("hs_theme") === "dark" ||
      (localStorage.getItem("hs_theme") === "auto" &&
        window.matchMedia("(prefers-color-scheme: dark)").matches);

    if (isLightOrAuto && html.classList.contains("dark"))
      html.classList.remove("dark");
    else if (isDarkOrAuto && html.classList.contains("light"))
      html.classList.remove("light");
    else if (isDarkOrAuto && !html.classList.contains("dark"))
      html.classList.add("dark");
    else if (isLightOrAuto && !html.classList.contains("light"))
      html.classList.add("light");
  </script>
</html>
